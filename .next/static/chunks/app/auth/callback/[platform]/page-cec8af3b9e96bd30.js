(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[163],{714:(t,e,a)=>{Promise.resolve().then(a.bind(a,7517))},747:(t,e,a)=>{"use strict";a.d(e,{N:()=>r});let r=(0,a(5974).UU)("https://keebszijifukhvpyfnlc.supabase.co","din_anon_key_h\xe4r")},2800:(t,e,a)=>{"use strict";a.d(e,{A:()=>s});var r=a(2115),n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),s=(t,e)=>{let a=(0,r.forwardRef)((a,s)=>{let{color:i="currentColor",size:l=24,strokeWidth:c=2,absoluteStrokeWidth:d,className:u="",children:f,...p}=a;return(0,r.createElement)("svg",{ref:s,...n,width:l,height:l,stroke:i,strokeWidth:d?24*Number(c)/Number(l):c,className:["lucide","lucide-".concat(o(t)),u].join(" "),...p},[...e.map(t=>{let[e,a]=t;return(0,r.createElement)(e,a)}),...Array.isArray(f)?f:[f]])});return a.displayName="".concat(t),a}},7517:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>k});var r=a(5155),n=a(2115),o=a(6046);let s=0,i=new Map,l=t=>{if(i.has(t))return;let e=setTimeout(()=>{i.delete(t),f({type:"REMOVE_TOAST",toastId:t})},1e6);i.set(t,e)},c=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,1)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{let{toastId:a}=e;return a?l(a):t.toasts.forEach(t=>{l(t.id)}),{...t,toasts:t.toasts.map(t=>t.id===a||void 0===a?{...t,open:!1}:t)}}case"REMOVE_TOAST":if(void 0===e.toastId)return{...t,toasts:[]};return{...t,toasts:t.toasts.filter(t=>t.id!==e.toastId)}}},d=[],u={toasts:[]};function f(t){u=c(u,t),d.forEach(t=>{t(u)})}function p(t){let{...e}=t,a=(s=(s+1)%Number.MAX_VALUE).toString(),r=()=>f({type:"DISMISS_TOAST",toastId:a});return f({type:"ADD_TOAST",toast:{...e,id:a,open:!0,onOpenChange:t=>{t||r()}}}),{id:a,dismiss:r,update:t=>f({type:"UPDATE_TOAST",toast:{...t,id:a}})}}let h=(0,a(2800).A)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var m=a(747);class g{async saveConnection(t){let{data:{user:e}}=await m.N.auth.getUser();if(!e)throw Error("Ingen anv\xe4ndare inloggad");let{error:a}=await m.N.from("platform_connections").upsert({user_id:e.id,platform:t.platform,platform_user_id:t.platformUserId,access_token:t.accessToken,refresh_token:t.refreshToken,updated_at:new Date().toISOString()});if(a)throw a}async getConnection(t){let{data:{user:e}}=await m.N.auth.getUser();if(!e)throw Error("Ingen anv\xe4ndare inloggad");let{data:a,error:r}=await m.N.from("platform_connections").select("*").eq("user_id",e.id).eq("platform",t).single();if(r)throw r;return a}async deleteConnection(t){let{data:{user:e}}=await m.N.auth.getUser();if(!e)throw Error("Ingen anv\xe4ndare inloggad");let{error:a}=await m.N.from("platform_connections").delete().eq("user_id",e.id).eq("platform",t);if(a)throw a}}let w=new g;async function _(t,e,a){let r=await fetch("/api/auth/".concat(t,"/callback"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,state:a})});if(!r.ok)throw Error("Kunde inte ansluta till plattformen");return r.json()}function k(t){let{params:e}=t,a=(0,o.useRouter)(),s=(0,o.useSearchParams)();return(0,n.useEffect)(()=>{let t=s.get("code"),r=s.get("state"),n=s.get("error");(async function(){try{if(n)throw Error("Anslutningen avbr\xf6ts");if(!t||!r)throw Error("Ogiltig callback-URL");let{accessToken:o,refreshToken:s,platformUserId:i}=await _(e.platform,t,r);await w.saveConnection({platform:e.platform,accessToken:o,refreshToken:s,platformUserId:i}),p({title:"Anslutningen lyckades!",description:"Ditt ".concat(e.platform,"-konto har anslutits."),duration:5e3}),a.push("/dashboard")}catch(t){console.error("Callback error:",t),p({variant:"destructive",title:"N\xe5got gick fel",description:t instanceof Error?t.message:"Kunde inte ansluta till plattformen",duration:5e3}),a.push("/dashboard")}})()},[e.platform,a,s]),(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(h,{className:"mx-auto h-8 w-8 animate-spin"}),(0,r.jsxs)("p",{className:"mt-4",children:["Ansluter till ",e.platform,"..."]})]})})}}},t=>{var e=e=>t(t.s=e);t.O(0,[385,441,587,358],()=>e(714)),_N_E=t.O()}]);