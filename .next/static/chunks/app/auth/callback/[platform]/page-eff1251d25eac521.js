(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[268],{8497:function(t,e,r){Promise.resolve().then(r.bind(r,8495))},8495:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return u}});var n=r(3827),a=r(4090),o=r(7907),s=r(7788),i=r(8994),c=r(1498);async function l(t,e,r){let n=await fetch("/api/auth/".concat(t,"/callback"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,state:r})});if(!n.ok)throw Error("Kunde inte ansluta till plattformen");return n.json()}function u(t){let{params:e}=t,r=(0,o.useRouter)(),u=(0,o.useSearchParams)();return(0,a.useEffect)(()=>{let t=u.get("code"),n=u.get("state"),a=u.get("error");(async function(){try{if(a)throw Error("Anslutningen avbr\xf6ts");if(!t||!n)throw Error("Ogiltig callback-URL");let{accessToken:o,refreshToken:i,platformUserId:u}=await l(e.platform,t,n);await c.d.saveConnection({platform:e.platform,accessToken:o,refreshToken:i,platformUserId:u}),(0,s.Am)({title:"Anslutningen lyckades!",description:"Ditt ".concat(e.platform,"-konto har anslutits."),duration:5e3}),r.push("/dashboard")}catch(t){console.error("Callback error:",t),(0,s.Am)({variant:"destructive",title:"N\xe5got gick fel",description:t instanceof Error?t.message:"Kunde inte ansluta till plattformen",duration:5e3}),r.push("/dashboard")}})()},[e.platform,r,u]),(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(i.Z,{className:"mx-auto h-8 w-8 animate-spin"}),(0,n.jsxs)("p",{className:"mt-4",children:["Ansluter till ",e.platform,"..."]})]})})}},7788:function(t,e,r){"use strict";r.d(e,{Am:function(){return d},pm:function(){return f}});var n=r(4090);let a=0,o=new Map,s=t=>{if(o.has(t))return;let e=setTimeout(()=>{o.delete(t),u({type:"REMOVE_TOAST",toastId:t})},1e6);o.set(t,e)},i=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,1)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{let{toastId:r}=e;return r?s(r):t.toasts.forEach(t=>{s(t.id)}),{...t,toasts:t.toasts.map(t=>t.id===r||void 0===r?{...t,open:!1}:t)}}case"REMOVE_TOAST":if(void 0===e.toastId)return{...t,toasts:[]};return{...t,toasts:t.toasts.filter(t=>t.id!==e.toastId)}}},c=[],l={toasts:[]};function u(t){l=i(l,t),c.forEach(t=>{t(l)})}function d(t){let{...e}=t,r=(a=(a+1)%Number.MAX_VALUE).toString(),n=()=>u({type:"DISMISS_TOAST",toastId:r});return u({type:"ADD_TOAST",toast:{...e,id:r,open:!0,onOpenChange:t=>{t||n()}}}),{id:r,dismiss:n,update:t=>u({type:"UPDATE_TOAST",toast:{...t,id:r}})}}function f(){let[t,e]=n.useState(l);return n.useEffect(()=>(c.push(e),()=>{let t=c.indexOf(e);t>-1&&c.splice(t,1)}),[t]),{...t,toast:d,dismiss:t=>u({type:"DISMISS_TOAST",toastId:t})}}},5922:function(t,e,r){"use strict";r.d(e,{O:function(){return n}});let n=(0,r(9377).eI)("https://keebszijifukhvpyfnlc.supabase.co","din_anon_key_h\xe4r")},7461:function(t,e,r){"use strict";r.d(e,{Z:function(){return s}});var n=r(4090),a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),s=(t,e)=>{let r=(0,n.forwardRef)((r,s)=>{let{color:i="currentColor",size:c=24,strokeWidth:l=2,absoluteStrokeWidth:u,className:d="",children:f,...p}=r;return(0,n.createElement)("svg",{ref:s,...a,width:c,height:c,stroke:i,strokeWidth:u?24*Number(l)/Number(c):l,className:["lucide","lucide-".concat(o(t)),d].join(" "),...p},[...e.map(t=>{let[e,r]=t;return(0,n.createElement)(e,r)}),...Array.isArray(f)?f:[f]])});return r.displayName="".concat(t),r}},8994:function(t,e,r){"use strict";r.d(e,{Z:function(){return n}});/**
 * @license lucide-react v0.331.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(7461).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},1498:function(t,e,r){"use strict";r.d(e,{d:function(){return o}});var n=r(5922);class a{async saveConnection(t){let{data:{user:e}}=await n.O.auth.getUser();if(!e)throw Error("Ingen anv\xe4ndare inloggad");let{error:r}=await n.O.from("platform_connections").upsert({user_id:e.id,platform:t.platform,platform_user_id:t.platformUserId,access_token:t.accessToken,refresh_token:t.refreshToken,updated_at:new Date().toISOString()});if(r)throw r}async getConnection(t){let{data:{user:e}}=await n.O.auth.getUser();if(!e)throw Error("Ingen anv\xe4ndare inloggad");let{data:r,error:a}=await n.O.from("platform_connections").select("*").eq("user_id",e.id).eq("platform",t).single();if(a)throw a;return r}async deleteConnection(t){let{data:{user:e}}=await n.O.auth.getUser();if(!e)throw Error("Ingen anv\xe4ndare inloggad");let{error:r}=await n.O.from("platform_connections").delete().eq("user_id",e.id).eq("platform",t);if(r)throw r}}let o=new a}},function(t){t.O(0,[682,971,69,744],function(){return t(t.s=8497)}),_N_E=t.O()}]);